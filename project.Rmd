---
title: "RedWine"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# 加载你最终使用的所有组件
# 在这个代码块的分析中。
# 注意，在这个代码块中，将参数 "echo" 设为假。
# This prevents the code from displaying in the knitted HTML output.这可以避免代码混入 HTML 输出显示。
# 应当在文件中，对所有代码块设为 echo=FALSE 。
library(ggplot2)
```

```{r echo=FALSE, Load_the_Data}
# 加载数据
?wineQualityReds
pf = read.csv('wineQualityReds.csv')
```

# 单变量绘图选择
```{r echo=FALSE, Univariate_Plots}
str(pf)
summary(pf)
```
```{r echo=FALSE}
theme_set(theme_minimal(8))

ggplot(aes(fixed.acidity), data = pf) +
  geom_histogram(binwidth = .5) +
  scale_x_continuous(breaks = seq(4, 16, .5))
ggplot(aes(fixed.acidity), data = pf) +
  geom_histogram(binwidth = .05) +
  scale_x_log10(breaks = seq(4, 16, .5))
summary(pf$fixed.acidity)
```
图形看起来有一些左偏，经过对数转换后近似于正态分布，峰值处于8.0左右。
```{r echo=FALSE}
ggplot(aes(volatile.acidity), data = pf) +
  geom_histogram(binwidth = .02)
```
图形显示出了两个峰值，分别在0.42和0.58附近
```{r echo=FALSE}
ggplot(aes(citric.acid), data = pf) +
  geom_histogram(binwidth = .01)
summary(pf$citric.acid)
```
数值0的数量最多，远高于其他数值。
```{r echo=FALSE}
ggplot(aes(residual.sugar), data = pf) +
  geom_histogram()
ggplot(aes(residual.sugar), data = pf) +
  geom_histogram() +
  scale_x_log10(breaks = seq(1,10,.5))
```
图像显示为长尾型，经过对数转换后接近正态分布，峰值出现在2.25附近。
```{r echo=FALSE}
ggplot(aes(chlorides), data = pf) +
  geom_histogram()
ggplot(aes(chlorides), data = pf) +
  geom_histogram() +
  scale_x_log10(breaks = seq(.03, .3, .02))
```
图形为左偏长尾，经过对数转换后接近正态分布，峰值出现在0.08附近。
```{r echo=FALSE}
ggplot(aes(free.sulfur.dioxide), data = pf) +
  geom_histogram(binwidth = 3)
ggplot(aes(free.sulfur.dioxide), data = pf) +
  geom_histogram(binwidth = .05) +
  scale_x_log10(breaks = seq(3, 30, 2))
```
图形为左偏长尾，经过对数转换后接近双峰分布，峰值出现在6和16附近。
```{r echo=FALSE}
ggplot(aes(total.sulfur.dioxide), data = pf) +
  geom_histogram()
ggplot(aes(total.sulfur.dioxide), data = pf) +
  geom_histogram() +
  scale_x_log10(breaks = seq(10, 100, 5))
```
图形为左偏长尾，经过对数转换后接近正态分布，峰值出现在42附近。
```{r echo=FALSE}
ggplot(aes(density), data = pf) +
  geom_histogram()
summary(pf$density)
```
图形接近正态分布，最小值0.9901，最大值1.0037，中位数0.9967，均值0.9978。
```{r echo=FALSE}
ggplot(aes(pH), data = pf) +
  geom_histogram()
summary(pf$pH)
```
图形接近正态分布，最小值2.74，最大值4.01，中位数3.31，均值3.311
```{r echo=FALSE}
ggplot(aes(sulphates), data = pf) +
  geom_histogram()
ggplot(aes(sulphates), data = pf) +
  geom_histogram() +
  scale_x_log10(breaks = seq(0.5, 1, 0.1))
```
图形为左偏长尾，经过对数转换后接近正态分布，峰值出现在0.6附近。
```{r echo=FALSE}
ggplot(aes(alcohol), data = pf) +
  geom_histogram()
ggplot(aes(alcohol), data = pf) +
  geom_histogram() +
  scale_x_log10(breaks = seq(9, 10, .2))
```
图形为左偏，经过对数转换后依然左偏，峰值出现在9.5附近。
```{r echo=FALSE}
ggplot(aes(quality), data = pf) +
  geom_histogram(binwidth = .5) +
  scale_x_continuous(breaks = seq(3, 8, 1))
```
大部分的评分为5和6。
# 单变量分析

### 你的数据集结构是什么？
我的数据集选用了Udacity提供的“红葡萄酒质量”数据集。该数据集共有1599行（1599种红葡萄酒）、13列（分别表示11个关于红酒的化学成分变量、1项红酒质量评分和序号）。
### 你的数据集内感兴趣的主要特性有哪些？
我最感兴趣的特性是酒的质量评分，即quality。
### 你认为数据集内哪些其他特征可以帮助你探索兴趣特点？
通过阅读数据集的官方说明，我认为volatile.acidity，citric.acid，residual.sugar，total.sulfur.dioxide与quality关系比较密切，存在相关性。
### 根据数据集内已有变量，你是否创建了任何新变量？
没有创建新的变量。
### 在已经探究的特性中，是否存在任何异常分布？你是否对数据进行一些操作，如清洁、调整或改变数据的形式？如果是，你为什么会这样做？
volatile.acidity，citric.acid等特性存在异常值，我会在坐标轴上选取合适的范围来排除异常值的影响。


# 双变量绘图选择
```{r echo=FALSE, Bivariate_Plots}
library('GGally')

set.seed(10)
ggpairs(pf[sample.int(nrow(pf), 1000), ], axisLabels = 'internal')
```
通过上图发现，quality与其他特性并没有很强的相关性，只与alcohol特性存在中度的正相关性。
```{r}
ggplot(aes(volatile.acidity, quality), data = pf) +
  geom_point(alpha = .25)
```
不同评分的酒，均含有相同的volatile.acidity数值，没有体现出明显的相关性。在质量评分为5、6、7分的酒中，volatile.acidity的数值集中在 0.2-0.8 之间。
```{r}
ggplot(aes(citric.acid, quality), data = pf) +
  geom_point(alpha = .25)
```
不同评分的酒，均含有相同的volatile.acidity数值，没有体现出明显的相关性。在质量评分为5、6、7分的酒中，citric.acid的数值集中在 0.00-0.625 之间。
```{r}
ggplot(aes(quality, residual.sugar), data = pf) +
  geom_point(alpha = .1)
```
residual.sugar的数值大部分集中在1-4之间。
```{r}
ggplot(aes(quality, residual.sugar), data = pf) +
  coord_cartesian(ylim = c(quantile(pf$residual.sugar, .05), 
                           quantile(pf$residual.sugar, .95))) +
  scale_y_continuous(breaks = seq(quantile(pf$residual.sugar, .05),
                                  quantile(pf$residual.sugar, .95),
                                  .2)) +
  geom_point(alpha = 0.1, color = 'orange') +
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(prob = .1),
            linetype = 2, color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(prob = .5),
            color = 'blue') +
  geom_line(stat = 'summary', fun.y = quantile, fun.args = list(prob = .9),
            linetype = 2, color = 'blue')
```
不同质量的酒的residual.sugar数值，中位数的均值的变化比较平缓，但是第三四分位数的变化较大。可能是因为除了评分5和6的酒，其他分值的酒样本较少，第三四分位数受极值影响较大。
```{r}
library(gridExtra)
p2_1 = ggplot(aes(quality, residual.sugar), 
              data = subset(pf, quality==5)) +
  geom_boxplot(color = 'red') +
  coord_cartesian(ylim = c(1,4)) +
  stat_summary(fun.y = mean, geom = 'point', shape = 4)
p2_2 = ggplot(aes(quality, residual.sugar), 
              data = subset(pf, quality==6)) +
  geom_boxplot(color = 'blue') +
  coord_cartesian(ylim = c(1,4)) +
  stat_summary(fun.y = mean, geom = 'point', shape = 4)
grid.arrange(p2_1, p2_2, ncol = 2)
summary(subset(pf, quality==5)$residual.sugar)
summary(subset(pf, quality==6)$residual.sugar)
```
重点查看一下评分5和6的酒的residual.sugar数值。评分5和6的酒的residual.sugar的数值大部分在1-3.5之间，均值分别为2.529和2.477，第一四分位值均为1.9，中位数均为2.2。
```{r}
ggplot(aes(total.sulfur.dioxide, quality), data = pf) +
  geom_point(alpha = .1)
```
不同评分的酒，均含有相同的volatile.acidity数值，没有体现出明显的相关性。
```{r}
ggplot(aes(quality, total.sulfur.dioxide), 
       data = subset(pf, quality==5 | quality==6)) +
  facet_wrap(~quality) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4)

library(reshape2)
summary(dcast(subset(pf, quality==5 | quality==6), 
              X~quality, value.var = 'total.sulfur.dioxide'))
```
重点查看评分为5和6的酒的total.sulfur.dioxide数据。在评分为5的酒中，total.sulfur.dioxide数据集中在26-84之间，均值和中位数分别为56.51和47；在评分为6的酒中，total.sulfur.dioxide数据集中在23-54之间，均值和中位数分别为40.87和35。
```{r}
ggplot(aes(fixed.acidity, volatile.acidity), data = pf) +
  geom_point(alpha = .4) +
  geom_smooth(method = 'lm', color = 'orange')
with(pf, cor.test(fixed.acidity, volatile.acidity))
```
fixed.acidity和volatile.acidity之间存在较弱的负相关性
```{r}
ggplot(aes(fixed.acidity, citric.acid), data = pf) +
  geom_point(alpha = .4) +
  geom_smooth(method = 'lm', color = 'orange')
with(pf, cor.test(fixed.acidity, citric.acid))
```
fixed.acidity和citric.acid之间存在较强的正相关性
```{r}
ggplot(aes(volatile.acidity, citric.acid), data = pf) +
  geom_point(alpha = .4) +
  coord_cartesian(ylim = c(0,1)) +
  geom_smooth(method = 'lm', color = 'orange')
with(pf, cor.test(volatile.acidity, citric.acid))
```
volatile.acidity和citric.acid之间存在较强的负相关性
```{r}
ggplot(aes(free.sulfur.dioxide, total.sulfur.dioxide), data = pf) +
  geom_point(alpha = .2)
with(pf, cor.test(free.sulfur.dioxide, total.sulfur.dioxide))
```
free.sulfur.dioxide和total.sulfur.dioxide之间存在较强的正相关性
```{r}
ggplot(aes(fixed.acidity, pH), data = pf) +
  geom_point(alpha = .2)
with(pf, cor.test(fixed.acidity, pH))
```
fixed.acidity和pH之间存在较强的负相关性。


# 双变量分析

### 探讨你在这部分探究中观察到的一些关系。这些感兴趣的特性与数据集内其他特性有什么区别？
这些感兴趣的特性与数据集内其他特性与quality均没有较强的相关性。
### 你是否观察到主要特性与其他特性之间的有趣关系？
fixed.acidity，volatile.acidity，citric.acid之间存在明显的相关性；free.sulfur.dioxide和total.sulfur.dioxide之间存在较强的正相关性；fixed.acidity和pH之间存在较强的负相关性。
### 你发现最强的关系是什么？
最强的关系为fixed.acidity与pH，相关系数为-0.683。



# 多变量绘图选择

```{r echo=FALSE, Multivariate_Plots}
ggplot(aes(fixed.acidity, pH), data = pf) +
  geom_point(aes(color = density))
ggplot(aes(fixed.acidity, pH), data = pf) +  
  geom_line(aes(color = density), stat = 'summary', fun.y = median)
```

可以看出，pH值的中位数随fixed.acidity值的增加而降低。密度较小的酒pH值一般较高，密度较大的酒一般pH值较低。
# 多变量分析

###  探讨你在这部分探究中观察到的一些关系。通过观察感兴趣的特性，是否存在相互促进的特性？
可以看出，pH值的中位数随fixed.acidity值的增加而降低。密度较小的酒pH值一般较高，密度较大的酒一般pH值较低。

### 这些特性之间是否存在有趣或惊人的联系呢？
相同范畴的特性之间联系较大（比如fixed.acidity，volatile.acidity，citric.acid或者free.sulfur.dioxide，total.sulfur.dioxide）
### 选项：你是否创建过数据集的任何模型？讨论你模型的优缺点。

------

# 定稿图与总结

### 绘图一
```{r echo=FALSE, Plot_One}
ggplot(aes(quality), data = pf) +
  geom_histogram(binwidth = .5) +
  scale_x_continuous(breaks = seq(3,8,1)) +
  xlab('Quality Score') +
  ylab('Number of Sample') +
  labs(title = 'Distribution of Quality Score') +
  theme(plot.title = element_text(hjust = 0.5)) #标题居中
```

### 描述一
样本中评分为5和6的酒的数量最多，数量远大于其他分值的酒。

### 绘图二
```{r echo=FALSE, Plot_Two}
p2_1 = ggplot(aes(quality, residual.sugar), 
              data = subset(pf, quality==5)) +
  geom_boxplot(color = 'red') +
  xlab('') +
  ylab('') +
  coord_cartesian(ylim = c(1,4)) +
  scale_y_continuous(breaks = seq(1,4,.1)) +
  scale_x_continuous(breaks = seq(4.5,5.5,.5)) +
  stat_summary(fun.y = mean, geom = 'point', shape = 4)
p2_2 = ggplot(aes(quality, residual.sugar), 
              data = subset(pf, quality==6)) +
  geom_boxplot(color = 'blue') +
  xlab('') +
  ylab('') +
  coord_cartesian(ylim = c(1,4)) +
  scale_y_continuous(breaks = seq(1,4,.1)) +
  scale_x_continuous(breaks = seq(5.5,6.5,.5)) +
  stat_summary(fun.y = mean, geom = 'point', shape = 4)
grid.arrange(p2_1, p2_2, ncol = 2, 
             left = 'Residual.sugar Value',
             top = 'Distribution of Residual.sugar with Score 5 and 6',
             bottom = 'Quality Score')
```

### 描述二
residual.sugar的数值大部分在1-3.5之间，均值分别为2.529和2.477，第一四分位值和中位数完全一致。

### 绘图三
```{r echo=FALSE, Plot_Three}
ggplot(aes(fixed.acidity, pH), data = pf) +  
  geom_line(aes(color = density), stat = 'summary', fun.y = median) +
  scale_x_continuous(breaks = seq(6, 16, 2)) +
  labs(x = 'Fixed.acidity Value',
       y = 'pH Value',
       title = 'Relationship of Fixed.acidity and pH with Different Density') +
  theme(plot.title = element_text(hjust = 0.5))
```

### 描述三
 pH值的中位数随fixed.acidity值的增加而降低。密度较小的酒pH值一般较高，密度较大的酒一般pH值较低。
------

# 反思
开始时，我认为数据间会存在明显的相关性，但随着分析的深入，发现相关性并没有那么明显。例如，我在分析residual.sugar和pH的关系时，开始时认为residual.sugar的值越小，pH也应该越小，但通过分析发现，二者并没有相关性。 在未来的分析中，应当注意不要在分析数据前就形成先入为主的想法，容易造成方向错误。